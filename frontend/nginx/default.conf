server {
  listen 80;
  server_name _;

  # Serve compiled React assets
  root /usr/share/nginx/html;
  index index.html;

  # SPA routing
  location / {
    try_files $uri /index.html;
  }

  # Proxy API requests to Laravel (FastCGI through php-fpm)
  location ~ ^/api(?<path>/.*)?$ {
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME /var/www/public/index.php;
    fastcgi_param SCRIPT_NAME /index.php;
    fastcgi_param PATH_INFO $path;
    fastcgi_param DOCUMENT_ROOT /var/www/public;
    fastcgi_pass backend:9000;
  }
}
